
#### «إنَّ الحمدَ للهِ ، نحمدُه ونستعينُه ونستهديه ونستغفِرُه ، ونعوذُ باللهِ من شرورِ أنفسنِا ومن سيِّئاتِ أعمالِنا ، من يهدِه اللهُ فلا مُضلَّ له ، ومن يُضلِلْ فلا هاديَ له ، وأشهدُ أن لا إلهَ إلَّا اللهُ وحدَه لا شريكَ له ، وأشهدُ أنَّ محمَّدًا عبدُه ورسولُه»
---
### **إيه هي الثغرة دي؟**

ثغرة XSS هي ثغرة أمنية بتسمح للمهاجم بإدخال أكواد برمجية ضارة (عادةً JavaScript) في صفحات الويب بحيث يتم تشغيلها في متصفح الضحية. الهدف الأساسي منها هو سرقة بيانات، تنفيذ أوامر، أو خداع المستخدمين.

### **إيه الهدف اللي بتسعى له الثغرة؟**

- سرقة **بيانات حساسة** مثل الكوكيز أو التوكينات.
- تنفيذ أكواد خبيثة على جهاز المستخدم.
- خداع المستخدم لإجراء أفعال معينة (مثل إرسال فورم معين).
- تعطيل الموقع أو التلاعب بمحتواه.

### **إيه الأنظمة أو التطبيقات اللي بتتأثر بالثغرة دي؟**

أي تطبيق ويب يقوم بإظهار بيانات يتم إدخالها من المستخدمين دون التحقق منها بشكل صحيح، مثل:

- أنظمة إدارة المحتوى (CMS).
- المنتديات ومواقع التواصل الاجتماعي.
- مواقع التجارة الإلكترونية.

### **إزاي الثغرة بتشتغل؟**

الثغرة بتشتغل لما التطبيق:

1. يستقبل إدخال من المستخدم (زي اسم، تعليق، أو عنوان URL).
2. يعرض الإدخال ده في الصفحة دون تنظيفه أو التحقق منه.
3. المتصفح يشغل الأكواد اللي كتبها المهاجم كأنها جزء من الموقع.

مثال:

لو المستخدم كتب `<script>alert('Hacked!')</script>` وتم عرضه مباشرةً في الصفحة، الكود هيشتغل.

### **إيه هي الشروط اللي بتخلي النظام عرضة للثغرة دي؟**

- عدم استخدام تقنيات تنظيف المدخلات (**Input Validation**).
- عرض بيانات المستخدمين في الصفحة دون ترميزها بشكل صحيح (**Output Encoding**).
- عدم استخدام سياسات أمان مثل **Content Security Policy (CSP)**.

### **إزاي المهاجم بيستغل الثغرة دي؟**

- كتابة كود JavaScript في حقل إدخال (مثل التعليقات).
- إدخال الكود في رابط ومشاركة الرابط مع الضحايا.
- نشر الكود الضار في صفحات عامة على الموقع.

### **إيه التأثير اللي ممكن يحصل لو الثغرة تم استغلالها؟**

- **سرقة الكوكيز** الخاصة بالمستخدمين، مما يسمح للمهاجم بتسجيل الدخول لحساباتهم.
- خداع المستخدمين عن طريق تزوير محتوى الموقع.
- تثبيت برمجيات خبيثة على أجهزة المستخدمين.
- تعطيل الموقع أو التلاعب بمحتواه.

### **إيه مدى خطورة الثغرة؟**

- تعتمد الخطورة على التطبيق نفسه، لكنها غالبًا تُعتبر من الثغرات **العالية الخطورة** بسبب قدرتها على اختراق حسابات المستخدمين أو تعطيل النظام.

### **إيه الحلول اللي تمنع استغلال الثغرة؟**

1. **تنظيف المدخلات**: التأكد من أن كل مدخلات المستخدم لا تحتوي على أكواد خبيثة.
2. **ترميز المخرجات**: استخدام تقنيات مثل **HTML escaping** لتشفير المخرجات.
3. **الContent Security Policy (CSP)**: لمنع تشغيل الأكواد غير المصرح بها.
4. استخدام مكتبات جاهزة مثل **DOMPurify** لتنظيف المدخلات والمخرجات.

### **إيه الأدوات اللي ممكن تساعدني أكتشف وجود الثغرة دي؟**

- **الBurp Suite**
- **الOWASP ZAP**
- **الXSS Hunter**
- **الBrowser DevTools** (للتجربة اليدوية).

### **إزاي أقدر أجرب الثغرة عملياً في بيئة آمنة؟**

- إنشاء تطبيق ويب محلي على جهازك واختباره.
- استخدام تطبيقات جاهزة لتعلم الثغرات مثل:
    - **DVWA (Damn Vulnerable Web Application)**
    - OWASP Juice Shop

### فين ممكن تلاقي الثغرة ؟

- **الحقول القابلة للإدخال من المستخدمين:**
    
    - **نماذج الإدخال (Forms):**مثل:
        - حقول تسجيل الدخول (Username/Password).
        - حقول البحث في الموقع.
        - نماذج الاتصال أو التسجيل.
- **التعليقات والمشاركات:**
    
    - لو الموقع بيسمح للمستخدمين بكتابة تعليقات أو منشورات، ممكن المهاجم يدخل أكواد JavaScript في التعليقات وتظهر لباقي المستخدمين.
- **الروابط (URLs):**
    
    - أي صفحة بتعتمد على **parameters** في الرابط.مثال:
        
        ```jsx
        
        <http://example.com/search?q=><script>alert('XSS')</script>
        ```
        
        لو التطبيق ما بيتحققش من محتوى `q`، الثغرة هتشتغل.
        
- **رسائل الخطأ (Error Messages):**
    
    - لو التطبيق بيعرض رسائل خطأ فيها مدخلات المستخدم، ممكن الثغرة تتواجد.مثال:
        
        ```jsx
        Invalid username: <script>alert('XSS')</script>
        ```
        
- **صفحات الملف الشخصي (User Profiles):**
    
    - لو المستخدم بيقدر يعدل اسمه، صورته، أو أي بيانات شخصية، وممكن البيانات دي تظهر لزوار الصفحة، فده مكان محتمل للثغرة.
- **واجهات البرمجة (APIs):**
    
    - بعض الـ APIs اللي تعرض بيانات من المدخلات بشكل مباشر ممكن تكون عرضة للثغرات.
- **تطبيقات الدردشة (Chat Applications):**
    
    - رسائل الدردشة لو ما تمش تنظيفها، ممكن تحمل كود XSS يؤثر على الطرف الآخر.
- **واجهات الإدارة (Admin Panels):**
    
    - لو الإداري بيعرض مدخلات المستخدمين بدون تنظيفها.


### اللي كتبته في الأجندة ؟

الثغرة ليها تلت أنواع وهم :

- Dom-Based أصعبهم لأن لازم تبقي عارف الجافاسكربت كويس وبينعكس في الصفحة
- Reflected الأشهر بينهم وبتنعكس في الصفحة برضو
- Stored بيتم تخزينه في قاعدة البيانات واخطرهم

الثغرة دي من أشهر الثغرات ولازم تبقي فاهمها كويس عشان تعملها أوتوميشن . فكرتها أنك بتحط أكواد جافاسكربت في أماكن مينفعش تكتب فيها كود بس بتكون مش مؤمنة بشكل كبير وأكبر خطورة منها هي سرقة الكوكيز بتاعت المستخدم ثم account takeover .

عشان تصلحها فأنت محتاج تعمل validation لأي input عندك وتعمل incode لأي text

خطوات أكتشاف الثغرة كالأتي :

- دور علي أي input وأكتب في ورقة او علي نوشن جميع ال input feilds أو ال parameters اللي ينفع نحط فيها payload
- نبدأ ب test أي كلمة عادية زي flex0geek ونشوفها في ال source code
- أبسط test للثغرة هي

`<script>alert(1)</script>`

- تحليل كود الجافاسكربت كويس أوي والبحث عن طرق استغلاله
- نقدر نستخدم html injection زي ال img tag
- فهم الموقع شغال ازاي في ال client side

الفرق بين ال Reflected وال Dom:

الأتنين بينعكسوا في الصفحة لكن ال reflected بتتعامل مع السيرفر المصاب اللي مكتوب بلغة برمجة زي php او غيرها ك باك اند أما ال Dom فهو بيحلل الجافاسكربت ويشغلها مباشرة في ال client side

- عادي جدا تحط البايلود بتاعك في ال URL جمب ال / أو ال #
- ال location.search هو أي حاجه بعد ؟ مثل urlLink?search=hesham
- ال location.hash هو ال # اللي بيجي أخر ال URL
- من أكتر ال functions المستخدمة في الجافاسكربت هي replace وهي بتعتمد علي تغيير الحرف مرة واحدة فق يعني لو المبرمج كتب أن الموقع يغير المدخلات زي ال < وال > ب replace ف هيكون سهل أننا نعملها Baypass
- ال anchor href هو ده

`<a href='<https://example.com>'>Click me</a>`

ممكن المبرمج يكون عامل escape لأشهر الelements فالمفروض اننا نحط بايلودز مش معروفة وممكن نعمل custom tage

- لو لقينا canonical link ممكن نجرب نحط البايلود ده

`?'accesskey='x' onclick='alert(1)`

بعد كدة دوس ctrl + shift + x وأحتمال كبير يعملalert

### طريقة روود في اكتشاف ثغرة ال xss ؟

- بيجيب كل الروابط اللي فيها parameters عن طريق اداة paramspider ويحطهم في ملف بعد كدة بيستخدم أداة kxss علي الروابط اللي طلعت عشان يشوف هل فيه رابط مش بيتعملو validation ولا لا
- لا يهمل الفحص اليدوي
- بيستعمل أداة arjun عشان يشوف البراميترز المخفية عن طريق انه بيشوف الend points اللي بتبقي بأمتداد زي html,php,js,asp وبيستعمل الأداة معاها وبعد ما يطلع البراميترز المخفية بيتسعمل عليها اداة dalfox
- فيه ريبو اسمها payloadsAllTheThings فيها بايلودز ياما تقدر تستخدمها
- فيه اكستنشن اسمها wapplayzer بتجبلك الموقع شغال ب تكنولوجيز اي بأصداراتها ف بتدور علي البايلود المناسب لهذا الاصدار