#### «إنَّ الحمدَ للهِ ، نحمدُه ونستعينُه ونستهديه ونستغفِرُه ، ونعوذُ باللهِ من شرورِ أنفسنِا ومن سيِّئاتِ أعمالِنا ، من يهدِه اللهُ فلا مُضلَّ له ، ومن يُضلِلْ فلا هاديَ له ، وأشهدُ أن لا إلهَ إلَّا اللهُ وحدَه لا شريكَ له ، وأشهدُ أنَّ محمَّدًا عبدُه ورسولُه»
----
### أي هي ثغرة الCRLF ؟

ثغرة **CRLF Injection** هي إحدى ثغرات أمن المعلومات التي تُستغل نتيجة ضعف في التعامل مع المدخلات النصية في التطبيقات. اسم الثغرة مشتق من الأحرف الخاصة `CR` و`LF` التي تعني **Carriage Return** و**Line Feed**. هذان الرمزان يُستخدمان لإنهاء السطر في الملفات النصية والبروتوكولات مثل HTTP.

### كيف تحدث الثغرة؟

تحدث هذه الثغرة عندما يسمح التطبيق للمستخدم بإدخال بيانات تحتوي على رموز **CR** و**LF** دون التحقق أو تنقيح (sanitize) المدخلات. يؤدي ذلك إلى حقن سطور جديدة أو أوامر إضافية في استجابات السيرفر أو الملفات.

على سبيل المثال:

- رمز `CR` (`\r`) ينقل المؤشر إلى بداية السطر.
- رمز `LF` (`\n`) ينقل المؤشر إلى السطر التالي.

### أمثلة عملية:

### 1. **حقن في استجابة HTTP**

عند استغلال هذه الثغرة، يمكن للمهاجم التلاعب برؤوس HTTP headers.

مثال على مدخل:
```JavaScript
https://example.com/page?name=Hesham%0D%0ASet-Cookie:%20Admin=true
```
### ماذا يحدث؟

- ال `%0D` هو **CR**.
- ال `%0A` هو **LF**.

إذا لم يتحقق التطبيق من المدخلات، فإن الاستجابة قد تكون بالشكل التالي:
```HTTP
HTTP/1.1 200 OK
Content-Type: text/html
Set-Cookie: Admin=true

<!DOCTYPE html>
<html>
...
```
هنا يتم إضافة Header جديد (مثل Set-Cookie) يؤدي إلى مشاكل مثل التلاعب بالجلسات أو الاستيلاء على الصلاحيات.

### طرق الحماية:

1. **تنظيف المدخلات (Input Sanitization)**:
    - منع رموز **CRLF** من الدخول أو التأكد من تشفيرها قبل المعالجة.
2. **الترميز (Encoding)**:
    - ترميز المدخلات باستخدام طرق مثل **URL Encoding**.
3. **التعامل الآمن مع المدخلات**:
    - استخدام مكتبات تقوم بمعالجة البيانات بشكل آمن بدلاً من الاعتماد على السلاسل النصية مباشرة.
4. **الفحص الدوري للأكواد**:
    - مراجعة الأكواد للبحث عن أماكن استقبال المدخلات ومعالجتها.